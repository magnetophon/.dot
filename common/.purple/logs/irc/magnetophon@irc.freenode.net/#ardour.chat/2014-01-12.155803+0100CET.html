<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>Conversation with #ardour at Sun 12 Jan 2014 03:58:03 PM CET on magnetophon@irc.freenode.net (irc)</title></head><body><h3>Conversation with #ardour at Sun 12 Jan 2014 03:58:03 PM CET on magnetophon@irc.freenode.net (irc)</h3>
<font size="2">(03:58:03 PM)</font><b> The topic for #ardour is: ardour 3.5.143 is released | download: <a href="http://ardour.org/download">http://ardour.org/download</a> |  paste to <a href="http://pastebin.com/">http://pastebin.com/</a> | OS X users please /join #ardour-osx</b><br/>
<font size="2">(04:02:56 PM)</font><b> AndreeeCZ [<em>~AndreeeCZ@dsl-hkibrasgw1-58c08e-167.dhcp.inet.fi</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(04:03:11 PM)</font> <b>the_CLA_2:</b></font> oofus, las: Regarding solo logic and the remaining issue I mentioned last time: In addition to what we had discussed it also makes no sense (and as in my &quot;Mixdowns&quot; case causes issues) if a track causes upstream implicit solo if it doesn&apos;t have any input enabled. So upstream implicit soloing should depend on the tracks in/disk status - only soloing upstream when &quot;in&quot; is active.<br/>
<font color="#A82F2F"><font size="2">(04:04:30 PM)</font> <b>the_CLA_2:</b></font> s/tracks/track&apos;s<br/>
<font color="#A82F2F"><font size="2">(04:05:01 PM)</font> <b>las:</b></font> the_CLA_2: i don&apos;t see that at all. <br/>
<font color="#A82F2F"><font size="2">(04:05:20 PM)</font> <b>las:</b></font> the_CLA_2: oh wait, i see what you mean now<br/>
<font color="#A82F2F"><font size="2">(04:05:39 PM)</font> <b>las:</b></font> the_CLA_2: that could be hard to implement correctly<br/>
<font color="#A82F2F"><font size="2">(04:06:11 PM)</font> <b>the_CLA_2:</b></font> las: But is important, IMHO.<br/>
<font color="#A82F2F"><font size="2">(04:07:32 PM)</font> <b>the_CLA_2:</b></font> las: I also see other issues with the current logic, but would have to investigate further. This however is the most important stuff in my typical use cases.<br/>
<font size="2">(04:07:54 PM)</font><b> ahtik [<em>~ahtik@13.248.190.90.dyn.estpak.ee</em>] entered the room.</b><br/>
<font size="2">(04:08:15 PM)</font><b> thorwil [<em>~thorwil@p4FFB7D0D.dip0.t-ipconnect.de</em>] entered the room.</b><br/>
<font size="2">(04:15:37 PM)</font><b> jfx1985 [<em>~johnfox@ppp219-28.static.internode.on.net</em>] entered the room.</b><br/>
<font size="2">(04:16:56 PM)</font><b> jfx1985 left the room (quit: Client Quit).</b><br/>
<font size="2">(04:33:23 PM)</font><b> Leatuspenguin left the room (quit: Quit: Leaving).</b><br/>
<font size="2">(04:37:44 PM)</font><b> schiv [<em>~schiv@archlinux/developer/schiv</em>] entered the room.</b><br/>
<font size="2">(04:38:10 PM)</font><b> vihcs left the room (quit: Ping timeout: 265 seconds).</b><br/>
<font size="2">(04:41:57 PM)</font><b> zeckenarmee [<em>~georg@2a02:810a:8500:1a8:8aae:1dff:fe32:5630</em>] entered the room.</b><br/>
<font size="2">(04:42:43 PM)</font><b> Leatuspenguin [<em>~Leatuspen@79.97.10.192</em>] entered the room.</b><br/>
<font size="2">(04:48:48 PM)</font><b> N33T [<em>~christian@91-113-90-46.adsl.highway.telekom.at</em>] entered the room.</b><br/>
<font size="2">(04:52:09 PM)</font><b> nick_m left the room (quit: Quit: Leaving).</b><br/>
<font size="2">(04:58:47 PM)</font><b> Leatuspenguin left the room (quit: Quit: Leaving).</b><br/>
<font size="2">(05:04:17 PM)</font><b> alexisisis left the room (quit: Read error: Connection reset by peer).</b><br/>
<font size="2">(05:05:11 PM)</font><b> triune left the room (quit: Quit: in and out... the circle (and rod) of life!).</b><br/>
<font size="2">(05:07:43 PM)</font><b> triune [<em>~triune@unaffiliated/triune</em>] entered the room.</b><br/>
<font size="2">(05:14:31 PM)</font><b> colinf [<em>~colinf@94-30-95-158.xdsl.murphx.net</em>] entered the room.</b><br/>
<font size="2">(05:25:52 PM)</font><b> juser123 left the room (quit: Quit: juser123).</b><br/>
<font size="2">(05:26:45 PM)</font><b> naptastic [<em>~david@99-20-201-27.lightspeed.hstntx.sbcglobal.net</em>] entered the room.</b><br/>
<font size="2">(05:30:45 PM)</font><b> Joschiii [<em>~joschii@46.115.67.36</em>] entered the room.</b><br/>
<font size="2">(05:30:54 PM)</font><b> StillLearnin_ [<em>~StillLear@173-167-60-157-ip-static.hfc.comcastbusiness.net</em>] entered the room.</b><br/>
<font size="2">(05:33:15 PM)</font><b> Joschii left the room (quit: Ping timeout: 252 seconds).</b><br/>
<font size="2">(05:38:40 PM)</font><b> jpbouza__ [<em>~jpbouza@201.255.229.145</em>] entered the room.</b><br/>
<font size="2">(05:41:05 PM)</font><b> StillLearnin_ left the room (quit: Remote host closed the connection).</b><br/>
<font size="2">(05:41:59 PM)</font><b> jpbouza_ left the room (quit: Ping timeout: 245 seconds).</b><br/>
<font size="2">(05:44:25 PM)</font><b> HarryHaaren [<em>~Harry@89.18.71.207</em>] entered the room.</b><br/>
<font size="2">(05:46:53 PM)</font><b> StillLearnin [<em>~StillLear@c-174-60-196-216.hsd1.pa.comcast.net</em>] entered the room.</b><br/>
<font size="2">(05:48:02 PM)</font><b> ispy_ [<em>~quassel@trborder1.altair.com</em>] entered the room.</b><br/>
<font size="2">(05:55:11 PM)</font><b> alexisisis [<em>~alex@186.176.51.35</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(06:05:32 PM)</font> <b>rgareus:</b></font> the_CLA_2: if there&apos;s a dependency on In/Disk -&gt; changing In/Disk would need to re-evaluate solo-logic.<br/>
<font color="#A82F2F"><font size="2">(06:05:55 PM)</font> <b>rgareus:</b></font> the_CLA_2: and things get worse if you have auto-input enabled..<br/>
<font size="2">(06:08:51 PM)</font><b> StillLearnin left the room (quit: Remote host closed the connection).</b><br/>
<font color="#A82F2F"><font size="2">(06:13:23 PM)</font> <b>the_CLA_2:</b></font> rgareus: Auto-input has influence on the behaviour of in/disk status, but I&apos;d suggest that the solo logic simply follows the in/disk status no matter how the monitoring is configured.<br/>
<font color="#A82F2F"><font size="2">(06:14:47 PM)</font> <b>rgareus:</b></font> the_CLA_2: if you have auto-input enable, every time you toggle play/stop; it changes -&gt; recompute solo <br/>
<font color="#A82F2F"><font size="2">(06:15:08 PM)</font> <b>the_CLA_2:</b></font> rgareus: Yes.<br/>
<font color="#A82F2F"><font size="2">(06:15:10 PM)</font> <b>rgareus:</b></font> and that&apos;s a major performance issue<br/>
<font color="#A82F2F"><font size="2">(06:15:21 PM)</font> <b>rgareus:</b></font> the_CLA_2: latency compensation has the same issue<br/>
<font color="#A82F2F"><font size="2">(06:16:18 PM)</font> <b>rgareus:</b></font> the_CLA_2: it should depend on in/disk  but it&apos;s not viable to implement that.<br/>
<font color="#A82F2F"><font size="2">(06:18:50 PM)</font> <b>the_CLA_2:</b></font> rgareus: ATM I&apos;m more busy playing with an improvised 3 speaker setup - or rather I would be if Ardour wouldn&apos;t crash all the time... For example when trying to AFL a bus... *sigh*<br/>
<font color="#A82F2F"><font size="2">(06:19:06 PM)</font> <b>the_CLA_2:</b></font> bt coming soon...<br/>
<font color="#A82F2F"><font size="2">(06:19:08 PM)</font> <b>las:</b></font> rgareus: we could make it at least be correct when solo is explicitly changed, perhaps<br/>
<font color="#A82F2F"><font size="2">(06:20:50 PM)</font> <b>the_CLA_2:</b></font> http://pastebin.com/GqN0H56c<br/>
<font size="2">(06:20:53 PM)</font><b> kbn [<em>~kristian@21.109-247-201.customer.lyse.net</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(06:23:26 PM)</font> <b>rgareus:</b></font> the_CLA_2: mmh that&apos;s a new one.  did you change the channel count of a track with a send or the bus an existing send sends to?<br/>
<font color="#A82F2F"><font size="2">(06:24:01 PM)</font> <b>the_CLA_2:</b></font> rgareus: Err... not that I know of.<br/>
<font color="#A82F2F"><font size="2">(06:24:35 PM)</font> <b>the_CLA_2:</b></font> rgareus: Maybe the bus a send sends to got changed by a plugin.<br/>
<font color="#A82F2F"><font size="2">(06:26:16 PM)</font> <b>the_CLA_2:</b></font> rgareus: Using the zita ambisonics reverb on a bus - originally created as stereo, IIRC.<br/>
<font size="2">(06:26:56 PM)</font><b> Joschi__ [<em>~joschii@46.115.76.233</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(06:27:39 PM)</font> <b>rgareus:</b></font> the_CLA_2: that would explain it.<br/>
<font size="2">(06:30:11 PM)</font><b> Joschiii left the room (quit: Ping timeout: 252 seconds).</b><br/>
<font size="2">(06:33:58 PM)</font><b> drobilla [<em>~drobilla@dsl-67-204-56-164.acanac.net</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(06:34:05 PM)</font> <b>the_CLA_2:</b></font> Time for supper - bbl.<br/>
<font size="2">(06:34:28 PM)</font><b> habys [<em>~luke@50.73.79.113</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(06:35:23 PM)</font> <b>las:</b></font> rgareus: how would it explain it, just for my clarity :)<br/>
<font size="2">(06:36:41 PM)</font><b> boom1992_ [<em>~quassel@BA1222.ballee.wh.tu-darmstadt.de</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(06:36:42 PM)</font> <b>rgareus:</b></font> las: assert (mixbufs.available().get (DataType::AUDIO) &gt;= bufs_audio);   <br/>
<font size="2">(06:37:04 PM)</font><b> naptastic left the room (quit: Remote host closed the connection).</b><br/>
<font color="#A82F2F"><font size="2">(06:37:13 PM)</font> <b>rgareus:</b></font> las: I suspect adding a plugin on one side does not reconfigure IO on the target.<br/>
<font color="#A82F2F"><font size="2">(06:37:56 PM)</font> <b>rgareus:</b></font> las: I&apos;m just trying to reproduce that<br/>
<font size="2">(06:39:40 PM)</font><b> mzki [<em>~koza@87-207-54-178.dynamic.chello.pl</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(06:43:54 PM)</font> <b>rgareus:</b></font> las: I can reproduce (a variant of) the_CLA_2&apos;s bug.  it seems drag/dropping processors does not take the process-lock.<br/>
<font size="2">(06:48:52 PM)</font><b> ispy_ left the room (quit: Remote host closed the connection).</b><br/>
<font color="#A82F2F"><font size="2">(06:59:58 PM)</font> <b>rgareus:</b></font> las: I think my guess was good.  Route::add_processors() takes the processor-lock -- but not the process-lock<br/>
<font size="2">(07:00:00 PM)</font><b> jpbouza__ left the room (quit: Quit: Leaving).</b><br/>
<font color="#A82F2F"><font size="2">(07:01:26 PM)</font> <b>rgareus:</b></font> las: or at least not at the right time.<br/>
<font size="2">(07:10:54 PM)</font><b> colinf left the room (quit: Read error: Connection reset by peer).</b><br/>
<font size="2">(07:18:07 PM)</font><b> corresponder_ left the room (quit: Quit: Leaving).</b><br/>
<font size="2">(07:22:04 PM)</font><b> colinf [<em>~colinf@94-30-95-158.xdsl.murphx.net</em>] entered the room.</b><br/>
<font size="2">(07:26:20 PM)</font><b> colinf left the room (quit: Ping timeout: 246 seconds).</b><br/>
<font size="2">(07:29:02 PM)</font><b> jpbouza [<em>~jpbouza@201.255.229.145</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(07:30:16 PM)</font> <b>las:</b></font> rgareus: does it need to take the process lock?<br/>
<font color="#A82F2F"><font size="2">(07:35:02 PM)</font> <b>rgareus:</b></font> las: looks like it. the processor is inserted and activated (with processor-lock held),  and only then the process_lock() is taken and configure_processors() is called which reconfigures IO<br/>
<font color="#A82F2F"><font size="2">(07:35:42 PM)</font> <b>rgareus:</b></font> las: if the processor that is inserted changes the channel count  AND  audio is processed before IO is reconfigured -&gt; crash<br/>
<font color="#A82F2F"><font size="2">(07:36:01 PM)</font> <b>rgareus:</b></font> (or possible crash, depends)<br/>
<font color="#A82F2F"><font size="2">(07:36:37 PM)</font> <b>las:</b></font> rgareus: ah, that does seem like a problem indeed<br/>
<font color="#A82F2F"><font size="2">(07:36:55 PM)</font> <b>las:</b></font> rgareus: and in fact argues against the entire existence of the processor lock <br/>
<font color="#A82F2F"><font size="2">(07:37:41 PM)</font> <b>rgareus:</b></font> las: if the channel count does not change,  processor-lock alone would be fine<br/>
<font color="#A82F2F"><font size="2">(07:38:39 PM)</font> <b>las:</b></font> rgareus: but you can&apos;t know that until ... fairly late<br/>
<font color="#A82F2F"><font size="2">(07:38:40 PM)</font> <b>rgareus:</b></font> las: in most cases calling   configure_processors_unlocked()  is overkill. <br/>
<font color="#A82F2F"><font size="2">(07:39:35 PM)</font> <b>rgareus:</b></font> las: but that&apos;d be an even larger re-redesign.<br/>
<font color="#A82F2F"><font size="2">(07:43:09 PM)</font> <b>rgareus:</b></font> las: I&apos;m more and more tempted to get rid of all the locks.  There should be one lock to prevent concurrent UI calls. but the backend makes a deep-copy and just swaps ProcessorState() in-between process-cycles, lock-free.<br/>
<font color="#A82F2F"><font size="2">(07:43:50 PM)</font> <b>rgareus:</b></font> would be easy were it not for boost::shared_ptr<br/>
<font size="2">(07:44:43 PM)</font><b> jpbouza left the room (quit: Remote host closed the connection).</b><br/>
<font color="#A82F2F"><font size="2">(07:44:44 PM)</font> <b>rgareus:</b></font> maybe it is even easy with boost::shared_ptr and weak_ptr.. but I don&apos;t see how, yet<br/>
<font size="2">(07:46:09 PM)</font><b> colinf [<em>~colinf@94-30-95-158.xdsl.murphx.net</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(08:01:54 PM)</font> <b>rgareus:</b></font> las: the actual bug may also be that Route::process_output_buffers() -- which iterates over processors and runs them does NOT take a _processor_lock<br/>
<font color="#A82F2F"><font size="2">(08:02:21 PM)</font> <b>rgareus:</b></font> las: it should probably take a Glib::Threads::RWLock::ReaderLock<br/>
<font color="#A82F2F"><font size="2">(08:06:15 PM)</font> <b>rgareus:</b></font> but that can cause deadlocks..  add_processor() -&gt; takes processor-lock.  || JACK-takes process-lock -&gt; calls process_output_buffers() -&gt; wait for processor-lock ||  add_processor continues -&gt; calls reconfigure-io -&gt; take processor-lock -&gt; deadlock.<br/>
<font color="#A82F2F"><font size="2">(08:06:47 PM)</font> <b>rgareus:</b></font> add_processor continues -&gt; calls reconfigure-io -&gt; take *process*-lock -&gt; deadlock<br/>
<font size="2">(08:07:06 PM)</font><b> alexisisis left the room (quit: Remote host closed the connection).</b><br/>
<font color="#A82F2F"><font size="2">(08:07:43 PM)</font> <b>rgareus:</b></font> las: I think your above statement was right.  processor should not exist.<br/>
<font color="#A82F2F"><font size="2">(08:07:54 PM)</font> <b>las:</b></font> rgareus: there was something subtle about this<br/>
<font color="#A82F2F"><font size="2">(08:08:01 PM)</font> <b>las:</b></font> rgareus: but subtle in this game is normally wrong<br/>
<font color="#A82F2F"><font size="2">(08:08:25 PM)</font> <b>rgareus:</b></font> las: maybe GUI interaction?  <br/>
<font size="2">(08:08:28 PM)</font><b> ahtik left the room (quit: Quit: Leaving).</b><br/>
<font color="#A82F2F"><font size="2">(08:08:28 PM)</font> <b>las:</b></font> rgareus: removing it isn&apos;t trivial though<br/>
<font size="2">(08:08:48 PM)</font><b> ahtik [<em>~ahtik@13.248.190.90.dyn.estpak.ee</em>] entered the room.</b><br/>
<font color="#A82F2F"><font size="2">(08:08:57 PM)</font> <b>las:</b></font> rgareus: because that will cause a deadlock when an I/O reconfigure happens that causes new port allocation (I think)<br/>
<font color="#A82F2F"><font size="2">(08:10:34 PM)</font> <b>rgareus:</b></font> las: jack-port creation is not a RT task. It should be possible to solve this case<br/>
<font color="#A82F2F"><font size="2">(08:11:12 PM)</font> <b>las:</b></font> rgareus: right, but if (GUI-ly) messing with the processor list takes the process lock, and then an IO object needs to add a port ...<br/>
<font color="#A82F2F"><font size="2">(08:11:18 PM)</font> <b>rgareus:</b></font> las: first idea would be to change all _processor_lock   into process_lock <br/>
<font color="#A82F2F"><font size="2">(08:11:48 PM)</font> <b>rgareus:</b></font> (and remove the dups where a function would take both)<br/>
