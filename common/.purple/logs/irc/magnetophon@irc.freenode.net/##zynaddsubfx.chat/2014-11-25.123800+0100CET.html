<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>Conversation with ##zynaddsubfx at Tue 25 Nov 2014 12:38:00 PM CET on magnetophon@irc.freenode.net (irc)</title></head><body><h3>Conversation with ##zynaddsubfx at Tue 25 Nov 2014 12:38:00 PM CET on magnetophon@irc.freenode.net (irc)</h3>
<font color="#A82F2F"><font size="2">(02:49:20 PM)</font> <b>__johannes:</b></font> fundamental: Is it valid to pass msg_args as &quot;&quot; in rtosc_vmessage(buffer, 2048, path, msg_args, va); ?<br/>
<font color="#A82F2F"><font size="2">(02:51:58 PM)</font> <b>__johannes:</b></font> I send &quot;close-ui&quot; like this, and rtosc_vmessage returns non-0, but the lo_message_deserialize returns an error<br/>
<font color="#A82F2F"><font size="2">(03:08:54 PM)</font> <b>fundamental:</b></font> __johannes: yes that&apos;s valid<br/>
<font color="#A82F2F"><font size="2">(03:13:49 PM)</font> <b>fundamental:</b></font> perhaps you&apos;re omitting the initial &apos;/&apos;?<br/>
<font color="#A82F2F"><font size="2">(03:14:52 PM)</font> <b>__johannes:</b></font> no, that&apos;s in it<br/>
<font color="#A82F2F"><font size="2">(03:18:22 PM)</font> <b>fundamental:</b></font> here the results of rtosc_message(buffer,2048, &quot;/close-ui&quot;, &quot;&quot;); passed into lo_message_deserialise returns non-null<br/>
<font color="#A82F2F"><font size="2">(03:20:32 PM)</font> <b>__johannes:</b></font> hang on...<br/>
<font color="#A82F2F"><font size="2">(03:23:48 PM)</font> <b>__johannes:</b></font> bool lo_port_t::send_rtosc_msg(const char *path, const char *msg_args, ...) const<br/>
<font color="#A82F2F"><font size="2">(03:23:51 PM)</font> <b>__johannes:</b></font> {<br/>
<font color="#A82F2F"><font size="2">(03:23:54 PM)</font> <b>__johannes:</b></font> 	va_list va;<br/>
<font color="#A82F2F"><font size="2">(03:23:56 PM)</font> <b>__johannes:</b></font> 	va_start(va, msg_args);<br/>
<font color="#A82F2F"><font size="2">(03:23:59 PM)</font> <b>__johannes:</b></font> 	char buffer[2048];<br/>
<font color="#A82F2F"><font size="2">(03:24:01 PM)</font> <b>__johannes:</b></font> 	size_t len = rtosc_vmessage(buffer, 2048, path, msg_args, va);<br/>
<font color="#A82F2F"><font size="2">(03:24:04 PM)</font> <b>__johannes:</b></font> 	va_end(va);<br/>
<font color="#A82F2F"><font size="2">(03:24:06 PM)</font> <b>__johannes:</b></font> 	lo_message msg = lo_message_deserialise(buffer, len, nullptr);<br/>
<font color="#A82F2F"><font size="2">(03:24:09 PM)</font> <b>__johannes:</b></font> 	if(dest)<br/>
<font color="#A82F2F"><font size="2">(03:24:11 PM)</font> <b>__johannes:</b></font> 	 lo_send_message(dest, buffer, msg);<br/>
<font color="#A82F2F"><font size="2">(03:24:14 PM)</font> <b>__johannes:</b></font> 	return true;<br/>
<font color="#A82F2F"><font size="2">(03:24:16 PM)</font> <b>__johannes:</b></font> }<br/>
<font color="#A82F2F"><font size="2">(03:24:43 PM)</font> <b>__johannes:</b></font> This is what I&apos;ve used, called like: lo_port.send_rtosc_msg(&quot;/close-ui&quot;, &quot;&quot;);<br/>
<font color="#A82F2F"><font size="2">(03:24:43 PM)</font> <b>fundamental:</b></font> ok, let me verify that all shifts work correctly<br/>
<font color="#A82F2F"><font size="2">(03:24:52 PM)</font> <b>fundamental:</b></font> but that should work<br/>
<font color="#A82F2F"><font size="2">(03:25:35 PM)</font> <b>__johannes:</b></font> either it&apos;s a strange bug, or a bug in liblo, which I use in the github version<br/>
<font color="#A82F2F"><font size="2">(03:26:12 PM)</font> <b>fundamental:</b></font> well, the last four or so times I thought it was liblo it was rtosc, so I&apos;m thinking it might be rtosc<br/>
<font color="#A82F2F"><font size="2">(03:26:15 PM)</font> <b>__johannes:</b></font> github -&gt; sourceforge<br/>
<font color="#A82F2F"><font size="2">(03:26:43 PM)</font> <b>fundamental:</b></font> if you can gdb it when it breaks I&apos;ll tell you what the rtosc buffer should be<br/>
<font color="#A82F2F"><font size="2">(03:28:31 PM)</font> <b>fundamental:</b></font> the length should be 16 and the contents should be /clo se-u i\0\0\0 ,\0\0\0<br/>
<font color="#A82F2F"><font size="2">(03:28:43 PM)</font> <b>fundamental:</b></font> with the spaces just separating the 32bit words<br/>
<font color="#A82F2F"><font size="2">(03:29:36 PM)</font> <b>__johannes:</b></font> ah wait, I think it now passes the lo call, but I get this: zynaddsubfx: /tmp/cprogs/zyn_orig/rtosc/src/rtosc.c:69: rtosc_type: Assertion `nargument &lt; rtosc_narguments(msg)&apos; failed.<br/>
<font color="#A82F2F"><font size="2">(03:29:39 PM)</font> <b>fundamental:</b></font> if the buffer is that value and the length is that value and there&apos;s not a little note in liblo&apos;s documentation that requires word alignment, then this should be fine<br/>
<font color="#A82F2F"><font size="2">(03:30:18 PM)</font> <b>__johannes:</b></font> this zyn message only comes if I send close-ui, if not, never shows up<br/>
<font color="#A82F2F"><font size="2">(03:30:32 PM)</font> <b>__johannes:</b></font> and it comes from the zynaddsubfx process<br/>
<font color="#A82F2F"><font size="2">(03:31:19 PM)</font> <b>fundamental:</b></font> well, it looks like something is trying to get an argument type without properly checking the number of arguments<br/>
<font color="#A82F2F"><font size="2">(03:31:37 PM)</font> <b>fundamental:</b></font> I&apos;d estimate it&apos;s some of the hackyier dispatch code in middleware, but I might be wrong<br/>
<font color="#A82F2F"><font size="2">(03:34:17 PM)</font> <b>__johannes:</b></font> oh... it&apos;s indeed a bug of zyn...<br/>
<font color="#A82F2F"><font size="2">(03:34:41 PM)</font> <b>__johannes:</b></font> oscprompt produces the same crash<br/>
<font color="#A82F2F"><font size="2">(03:35:20 PM)</font> <b>__johannes:</b></font> ok just fyi: I think it worked 2 months ago<br/>
<font color="#A82F2F"><font size="2">(03:35:30 PM)</font> <b>fundamental:</b></font> yeah the only time that crash should show up is when the message type is being inspected or arguments are getting retrieved<br/>
<font color="#A82F2F"><font size="2">(03:35:48 PM)</font> <b>fundamental:</b></font> if you get the backtrace, then it should be a pretty trivial fix<br/>
<font color="#A82F2F"><font size="2">(03:37:24 PM)</font> <b>__johannes:</b></font> I&apos;ll try<br/>
<font color="#A82F2F"><font size="2">(03:37:57 PM)</font> <b>__johannes:</b></font> also, oscprompt shows there&apos;s a &quot;/ze_state&quot;, but zyn only knows &quot;/freeze_state&quot;<br/>
<font color="#A82F2F"><font size="2">(03:38:36 PM)</font> <b>fundamental:</b></font> oh, that one might be more &quot;fun&quot; to fix<br/>
<font color="#A82F2F"><font size="2">(03:43:00 PM)</font> <b>__johannes:</b></font> ok the relevant part of the bt:<br/>
<font color="#A82F2F"><font size="2">(03:43:03 PM)</font> <b>__johannes:</b></font> #3  0x00007ffff46151c2 in __assert_fail () from /lib64/libc.so.6<br/>
<font color="#A82F2F"><font size="2">(03:43:03 PM)</font> <b>__johannes:</b></font> #4  0x00007ffff53c3f39 in rtosc_type (msg=0x7fffef079011 &quot;close-ui&quot;, nargument=0) at /tmp/cprogs/zyn_orig/rtosc/src/rtosc.c:69<br/>
<font color="#A82F2F"><font size="2">(03:43:06 PM)</font> <b>__johannes:</b></font> #5  0x00007ffff53c4864 in rtosc_argument (msg=0x7fffef079011 &quot;close-ui&quot;, idx=0) at /tmp/cprogs/zyn_orig/rtosc/src/rtosc.c:387<br/>
<font color="#A82F2F"><font size="2">(03:43:09 PM)</font> <b>__johannes:</b></font> #6  0x00000000004ed75f in operator() (__closure=&lt;optimized out&gt;, d=..., m=&lt;optimized out&gt;) at /tmp/cprogs/zyn_orig/src/UI/Connection.cpp:133<br/>
<font color="#A82F2F"><font size="2">(03:43:12 PM)</font> <b>__johannes:</b></font> #7  std::_Function_handler&lt;void(char const*, rtosc::RtData&amp;), __lambda6&gt;::_M_invoke(const std::_Any_data &amp;, const char *, rtosc::RtData &amp;) (__functor=..., __args#0=&lt;optimized out&gt;, __args#1=...) at /usr/include/c++/4.8/functional:2071<br/>
<font color="#A82F2F"><font size="2">(03:43:17 PM)</font> <b>__johannes:</b></font> #8  0x00007ffff51ae9ee in rtosc::Ports::dispatch (this=this@entry=0x7a64e0 &lt;ports&gt;, m=m@entry=0x7fffef079011 &quot;close-ui&quot;, d=...) at /tmp/cprogs/zyn_orig/rtosc/src/cpp/ports.cpp:528<br/>
<font color="#A82F2F"><font size="2">(03:43:20 PM)</font> <b>__johannes:</b></font> #9  0x00000000004ee270 in GUI::raiseUi (gui=0x11a0dc0, message=0x7fffef079010 &quot;/close-ui&quot;) at /tmp/cprogs/zyn_orig/src/UI/Connection.cpp:149<br/>
<font color="#A82F2F"><font size="2">(03:43:23 PM)</font> <b>__johannes:</b></font> #10 0x0000000000473f93 in bToUhandle (rtmsg=0x7fffef079010 &quot;/close-ui&quot;, this=&lt;optimized out&gt;) at /tmp/cprogs/zyn_orig/src/Misc/MiddleWare.cpp:573<br/>
<font color="#A82F2F"><font size="2">(03:43:26 PM)</font> <b>__johannes:</b></font> #11 tick (this=&lt;optimized out&gt;) at /tmp/cprogs/zyn_orig/src/Misc/MiddleWare.cpp:591<br/>
<font color="#A82F2F"><font size="2">(03:43:29 PM)</font> <b>__johannes:</b></font> #12 MiddleWare::tick (this=&lt;optimized out&gt;) at /tmp/cprogs/zyn_orig/src/Misc/MiddleWare.cpp:988<br/>
<font color="#A82F2F"><font size="2">(03:43:32 PM)</font> <b>__johannes:</b></font> #13 0x0000000000444447 in main (argc=&lt;optimized out&gt;, argv=0x7fffffffdde8) at /tmp/cprogs/zyn_orig/src/main.cpp:492<br/>
<font color="#A82F2F"><font size="2">(03:43:35 PM)</font> <b>__johannes:</b></font> if this is too &quot;optimized-out&quot;, let me know<br/>
<font color="#A82F2F"><font size="2">(03:45:39 PM)</font> <b>fundamental:</b></font> hm<br/>
<font color="#A82F2F"><font size="2">(03:45:45 PM)</font> <b>fundamental:</b></font> I see where it must crash<br/>
<font color="#A82F2F"><font size="2">(03:45:57 PM)</font> <b>fundamental:</b></font> but I also see an if statement guarding it<br/>
<font color="#A82F2F"><font size="2">(03:46:50 PM)</font> <b>__johannes:</b></font> same git versions?<br/>
<font color="#A82F2F"><font size="2">(03:47:45 PM)</font> <b>fundamental:</b></font> I&apos;m one commit behind the git master branch&apos;s HEAD<br/>
<font color="#A82F2F"><font size="2">(03:47:59 PM)</font> <b>fundamental:</b></font> are you on another branch?<br/>
<font color="#A82F2F"><font size="2">(03:48:26 PM)</font> <b>__johannes:</b></font> think I&apos;m on master, but wait<br/>
<font color="#A82F2F"><font size="2">(03:49:02 PM)</font> <b>__johannes:</b></font> do I need to update rtosc, since it&apos;s a submodule? I guess no?<br/>
<font color="#A82F2F"><font size="2">(03:49:22 PM)</font> <b>fundamental:</b></font> git submodule update<br/>
<font color="#A82F2F"><font size="2">(03:49:37 PM)</font> <b>fundamental:</b></font> that would possibly explain the &quot;/ze_state&quot;<br/>
<font color="#A82F2F"><font size="2">(03:49:47 PM)</font> <b>__johannes:</b></font> ok I have no changes for rtosc, but my zyn code was old<br/>
<font color="#A82F2F"><font size="2">(03:50:34 PM)</font> <b>__johannes:</b></font> oh, now it works...<br/>
<font color="#A82F2F"><font size="2">(03:50:41 PM)</font> <b>__johannes:</b></font> sorry, my fault<br/>
<font color="#A82F2F"><font size="2">(03:50:57 PM)</font> <b>__johannes:</b></font> you must have fixed this bug recently<br/>
<font color="#A82F2F"><font size="2">(03:50:58 PM)</font> <b>fundamental:</b></font> no problem<br/>
<font color="#A82F2F"><font size="2">(03:51:57 PM)</font> <b>fundamental:</b></font> I threw the ze_state bug up on sourceforge as I will investigate that one when I have more time to try to get it to reproduce<br/>
<font color="#A82F2F"><font size="2">(03:52:29 PM)</font> <b>__johannes:</b></font> ok I have also a small feature request, don&apos;t know if it makes sense<br/>
<font color="#A82F2F"><font size="2">(03:52:40 PM)</font> <b>__johannes:</b></font> zynaddsubfx now shows where the lo port is automatically<br/>
<font color="#A82F2F"><font size="2">(03:52:55 PM)</font> <b>__johannes:</b></font> so if you type &quot;connect zynaddsubfx&quot;, it could find out the port by itself<br/>
<font color="#A82F2F"><font size="2">(03:53:04 PM)</font> <b>__johannes:</b></font> (by reading /tmp/zynaddsubfx...)<br/>
<font color="#A82F2F"><font size="2">(03:53:54 PM)</font> <b>fundamental:</b></font> well, I was planning on being able to do that exact same thing, but likely routing through JACK based OSC<br/>
<font color="#A82F2F"><font size="2">(03:54:04 PM)</font> <b>fundamental:</b></font> this does open a barrel of issues though<br/>
<font color="#A82F2F"><font size="2">(03:54:23 PM)</font> <b>fundamental:</b></font> and some code really needs to be put into place to clear up all the dead /tmp/zynaddsubfx* PID files<br/>
<font color="#A82F2F"><font size="2">(03:54:44 PM)</font> <b>__johannes:</b></font> ah I think they only occur on segfaults?<br/>
<font color="#A82F2F"><font size="2">(03:54:49 PM)</font> <b>fundamental:</b></font> yep<br/>
<font color="#A82F2F"><font size="2">(03:55:04 PM)</font> <b>__johannes:</b></font> ok I could write a safe cleanup routine for them<br/>
<font color="#A82F2F"><font size="2">(03:55:11 PM)</font> <b>fundamental:</b></font> which is what of a lot of my testing gets to segfaults/assert based aborts/etc<br/>
<font color="#A82F2F"><font size="2">(03:56:27 PM)</font> <b>__johannes:</b></font> what do you mean by routing though JACK based osc? what shall be routed`<br/>
<font color="#A82F2F"><font size="2">(03:56:29 PM)</font> <b>__johannes:</b></font> ?<br/>
<font color="#A82F2F"><font size="2">(03:57:12 PM)</font> <b>fundamental:</b></font> instead of feeding things over liblo things sent over jack or jack metadata could be used to find the udp url<br/>
<font color="#A82F2F"><font size="2">(03:57:37 PM)</font> <b>__johannes:</b></font> so you&apos;d still use /tmp files, but write jack &quot;adresses&quot; into them?<br/>
<font color="#A82F2F"><font size="2">(03:57:46 PM)</font> <b>fundamental:</b></font> now that I&apos;m thinking about it the /tmp files approach might be better<br/>
<font color="#A82F2F"><font size="2">(03:57:51 PM)</font> <b>fundamental:</b></font> (for getting responses from zyn)<br/>
<font color="#A82F2F"><font size="2">(03:59:13 PM)</font> <b>__johannes:</b></font> ah ok, I must read more about jack<br/>
<font size="2">(07:50:31 PM)</font><b> The account has disconnected and you are no longer in this chat. You will automatically rejoin the chat when the account reconnects.</b><br/>
</body></html>
